!function(a){"use strict";var b=function l(a,b,c){var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){var e=Object.getPrototypeOf(a);return null===e?void 0:l(e,b,c)}if("value"in d&&d.writable)return d.value;var f=d.get;return void 0===f?void 0:f.call(c)},c=function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(a.__proto__=b)},d=function(a,b,c){b&&Object.defineProperties(a,b),c&&Object.defineProperties(a.prototype,c)},e=function(){function a(a){this.renderer=a,a.world=new LiThree.World,this.atoms=[],this._display=!1,this._displays=[],this._mode=!1,this._modes=[],this._data={},this.orbitHelper=new f,this._attachInteractive()}return d(a,null,{attach:{value:function(a){var b;for(b in a.atoms){var c=a.atoms[b];this.addAtom(c)}},writable:!0,enumerable:!0,configurable:!0},addAtom:{value:function(a){this.atoms.push(a);var b;a.on("bond",function(){}),this._display.drawAtom(a);for(b in a.bonds){var c=a.bonds[b];this._display.drawBond(c)}},writable:!0,enumerable:!0,configurable:!0},setMode:{value:function(a){this._mode&&this._mode.down();for(var b in this._modes){var c=this._modes[b];if(c instanceof a)return this._mode=c,void this._mode.up()}this._mode=new a(this),this._mode.create(),this._modes.push(this._mode)},writable:!0,enumerable:!0,configurable:!0},setDisplay:{value:function(a){this._display&&this._display.down();for(var b in this._displays){var c=this._displays[b];if(c instanceof a)return this._display=c,void this._display.up()}this._display=new a(this),this._display.create(),this._displays.push(this._display)},writable:!0,enumerable:!0,configurable:!0},unsetData:{value:function(a){delete this._data[a]},writable:!0,enumerable:!0,configurable:!0},setData:{value:function(a){var b=void 0===arguments[1]?!0:arguments[1];this._data[a]=b},writable:!0,enumerable:!0,configurable:!0},getData:{value:function(a){return this._data[a]},writable:!0,enumerable:!0,configurable:!0},hasData:{value:function(a){return"undefined"!=typeof this._data[a]},writable:!0,enumerable:!0,configurable:!0},show:{value:function(){this.renderer.draw();var a=this;this.getData("tween")&&TWEEN&&TWEEN.update(),requestAnimationFrame(function(){a.show()})},writable:!0,enumerable:!0,configurable:!0},_attachInteractive:{value:function(){var a=this.renderer,b=new LiThree.Interactive(a);this.interactive=b},writable:!0,enumerable:!0,configurable:!0}}),a}(),f=function(){function a(){this.quaternion=new LiThree.Math.Quaternion,this.matrix=null,this.origin=new LiThree.Math.Vector3,this.speed=1,this._getMatrix()}return d(a,null,{rotate:{value:function(a,b){var c=Math.sqrt(a*a+b*b),d=new LiThree.Math.Quaternion(1,0,0,0),e=this.quaternion,f=Math.sin(c*Math.PI)/c;d.x=Math.cos(c*Math.PI),d.y=0,d.z=f*a,d.w=-f*b,this.quaternion=new LiThree.Math.Quaternion(1,0,0,0),this.quaternion.multiply(d),this.quaternion.multiply(e),this._getMatrix()},writable:!0,enumerable:!0,configurable:!0},_getMatrix:{value:function(){return this.matrix=LiThree.Math.Matrix4.fromRotationTranslationScaleOrigin(this.quaternion,this.origin,new LiThree.Math.Vector3(1,1,1),this.origin),this.matrix},writable:!0,enumerable:!0,configurable:!0}}),a}(),g=function(){function a(a){this.canvas=a,this._atoms=[]}return d(a,null,{drawAll:{value:function(){},writable:!0,enumerable:!0,configurable:!0}}),a}(),h="ball-and-stick",i=function(a){function e(a){this.lights=[],b(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,a)}return c(e,a),d(e,null,{drawLight:{value:function(){var a=new LiThree.Light.Point;a.specularColor.rgb(.2,.2,.2),a.position.x=-30,a.position.z=-60,a.position.y=-30,this.lights=[a]},writable:!0,enumerable:!0,configurable:!0},drawAtom:{value:function(a){var b=this.canvas,c=b.renderer,d=c.world,e=a.position,f=Math.exp(-Math.pow(a.element.atomicRadius-91,2)/500)*a.element.atomicRadius/200,g=LiThree.ObjectFactory.Sphere(f,20,20);g.position.copy(e),g.material.shininess=10,g.material.color.hex=a.element.color,d.add(g),c.initShape(g),this._orbitShader(g),g.shader.create();var i={sphere:g,position:g.position,color:g.material.color,radius:f};a.setData(h,i),b.getData("tween")&&(g.scale.set(0,0,0),new TWEEN.Tween(g.scale).to({x:1,y:1,z:1},500).easing(TWEEN.Easing.Elastic.Out).start())},writable:!0,enumerable:!0,configurable:!0},drawBond:{value:function(a){var b;a.hasData(h)?b=a.getData(h):(b={cylinders:[]},a.setData(h,b));var c=this.canvas.renderer,d=c.world,e=a.begin,f=a.end,g=e.getData(h),i=f.getData(h);if(g&&i){var j=g.position,k=i.position,l=g.color,m=i.color,n=j.distance(k),o=j.clone().add(k).divide(2),p=k.x-j.x,q=k.y-j.y,r=k.z-j.z,s=.07,t=new LiThree.Math.Quaternion;t.rotateZ(Math.atan2(q,p)),t.rotateY(-Math.asin(r/n));for(var u=(a.order-1)*s,v=0;v<a.order;v++){var w=LiThree.ObjectFactory.Cylinder(n,s,s);w.material.color=l,this._programCylinderShader(w,m),b.cylinders.push(w),d.add(w)}for(var x in b.cylinders){var w=b.cylinders[x];w.rotation=t,w.position.copy(o),w.position.y+=.2*x-u}}},writable:!0,enumerable:!0,configurable:!0},_programCylinderShader:{value:function(a,b){renderer.initShape(a);var c=a.shader.fragmentProgram,d=a.shader.vertexProgram;c.clear(),c.code("vec3 effectiveColor = halfColor > 0.5 ? vColor : %c2; gl_FragColor = vec4(%lw + effectiveColor, 1.0);",{c2:c.uniform("vec3",function(){this.value(b.toArray())}),hc:c.varying("float","halfColor"),lw:"lightWeight"}),d.code("%hc = %vp.x < 0.5 ? 1.0 : 0.0;",{lw:"lightWeight",vp:"vPosition",hc:d.varying("float","halfColor")}),this._orbitShader(a),a.shader.create()},writable:!0,enumerable:!0,configurable:!0},_orbitShader:{value:function(a){var b=a.shader.vertexProgram,c=this.canvas.orbitHelper;b.clear(),b.code("mat4 mvMatrix = %vm * %om * %mm;\ngl_Position = %p * mvMatrix  * vec4(%vp, 1.0);",{p:"pMatrix",vm:"vMatrix",mm:"mMatrix",vp:"vPosition",om:b.uniform("mat4",function(){this.value(c.matrix)})}),a.shader.initLighting()},writable:!0,enumerable:!0,configurable:!0},create:{value:function(){this.drawLight(),this.up()},writable:!0,enumerable:!0,configurable:!0},up:{value:function(){var a=renderer.world;for(var b in this.lights)a.add(this.lights[b])},writable:!0,enumerable:!0,configurable:!0},down:{value:function(){var a=renderer.world;for(var b in this.lights)a.remove(this.lights[b])},writable:!0,enumerable:!0,configurable:!0}}),e}(g),j=function(){function a(a){this.canvas=a}return d(a,null,{up:{value:function(){var a=this.canvas.interactive;a.on("drag",this._dragEvent),a.on("click",this._clickEvent),a.on("wheel",this._wheelEvent)},writable:!0,enumerable:!0,configurable:!0},down:{value:function(){var a=this.canvas.interactive;a.off("drag",this._dragEvent),a.off("click",this._clickEvent),a.off("wheel",this._wheelEvent)},writable:!0,enumerable:!0,configurable:!0},create:{value:function(){var a=this.canvas,b=a.renderer.camera;this._wheelEvent=function(c){if(a.getData("tween")){var d=b.position.z+c/50;new TWEEN.Tween(b.position).to({z:d},200).easing(TWEEN.Easing.Cubic.Out).start()}else b.position.z+=c/100},this._clickEvent=function(c,d){var e=d(0);e.unproject(_getMatrix());var f=new Chem.Atom;f.position=e,f.atomicNumber=6;var g=LiThree.Math.Ray.fromPoints(b.position,d(0)),h=g.intersectTriangle(new LiThree.Math.Vector3(-1,-1,0),new LiThree.Math.Vector3(-1,1,0),new LiThree.Math.Vector3(1,0,0));console.log(h),a.addAtom(f)},this._dragEvent=function(a,b,c,d){c(.5);0===d.button||2===d.button},this.up()},writable:!0,enumerable:!0,configurable:!0}}),a}(),k=function(){function a(a){this.canvas=a}return d(a,null,{up:{value:function(){var a=this.canvas.interactive;a.on("drag",this._dragEvent),a.on("wheel",this._wheelEvent)},writable:!0,enumerable:!0,configurable:!0},down:{value:function(){var a=this.canvas.interactive;a.off("drag",this._dragEvent),a.off("wheel",this._wheelEvent)},writable:!0,enumerable:!0,configurable:!0},create:{value:function(){var a=this.canvas,b=a.renderer.camera;this._wheelEvent=function(a){b.position.z+=a/100},this._dragEvent=function(c,d,e,f){if(0===f.button){var g=-d.x/400,h=-d.y/400;a.orbitHelper.rotate(g,h)}else 2===f.button&&(f.preventDefault(),b.position.x+=-d.x/100,b.position.y+=d.y/100)},this.up()},writable:!0,enumerable:!0,configurable:!0}}),a}();a.ChemCanvas={Canvas:e,Display:{BallAndStick:i},Mode:{Orbit:k,Editor:j}}}(this);
//# sourceMappingURL=chemcanvas.min.js.map