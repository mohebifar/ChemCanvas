!function(a){"use strict";var b=function m(a,b,c){var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){var e=Object.getPrototypeOf(a);return null===e?void 0:m(e,b,c)}if("value"in d&&d.writable)return d.value;var f=d.get;return void 0===f?void 0:f.call(c)},c=function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(a.__proto__=b)},d=function(a,b,c){b&&Object.defineProperties(a,b),c&&Object.defineProperties(a.prototype,c)},e=function(){function a(a){this.renderer=a,a.world=new LiThree.World,this.atoms=[],this.bonds=[],this._display=!1,this._displays=[],this._mode=!1,this._modes=[],this._data={},this.orbitHelper=new f(this),this._attachInteractive()}return d(a,null,{attach:{value:function(a){var b,c=this,d=this,e=0,f=a.atoms.length;for(b in a.atoms)!function(){var g=a.atoms[b];c.addAtom(g,function(){if(++e===f)for(var b in a.atoms){var c=a.atoms[b];for(var g in c.bonds)d.addBond(c.bonds[g])}},!1)}()},writable:!0,enumerable:!0,configurable:!0},clear:{value:function(){var a=this.atoms.slice(0,this.atoms.length);for(var b in a)this.removeAtom(a[b])},writable:!0,enumerable:!0,configurable:!0},addAtom:{value:function(a){var b=void 0===arguments[1]?!1:arguments[1],c=void 0===arguments[2]?!0:arguments[2];this.atoms.push(a);var d,e=this;if(a.on("bond",function(){}),a.on("delete",function(){for(var b in e._displays){var c=e._displays[b];c.removeAtom(a)}e.atoms.splice(e.atoms.indexOf(a),1)}),setTimeout(function(){e._display.drawAtom(a,b)},0),c)for(d in a.bonds)e.addBond(a.bonds[d])},writable:!0,enumerable:!0,configurable:!0},removeAtom:{value:function(a){a.emit("delete")},writable:!0,enumerable:!0,configurable:!0},addBond:{value:function(a){var b=this;b.bonds.push(a),a.on("delete",function(){for(var c in b._displays){var d=b._displays[c];d.removeBond(a)}b.bonds.splice(b.bonds.indexOf(a),1)}),setTimeout(function(){b._display.drawBond(a)},0)},writable:!0,enumerable:!0,configurable:!0},removeBond:{value:function(a){a.emit("delete")},writable:!0,enumerable:!0,configurable:!0},setMode:{value:function(a){this._mode&&this._mode.down();for(var b in this._modes){var c=this._modes[b];if(c instanceof a)return this._mode=c,void this._mode.up()}this._mode=new a(this),this._mode.create(),this._modes.push(this._mode)},writable:!0,enumerable:!0,configurable:!0},setDisplay:{value:function(a){this._display&&this._display.down();for(var b in this._displays){var c=this._displays[b];if(c instanceof a)return this._display=c,void this._display.up()}this._display=new a(this),this._display.create(),this._displays.push(this._display)},writable:!0,enumerable:!0,configurable:!0},unsetData:{value:function(a){delete this._data[a]},writable:!0,enumerable:!0,configurable:!0},setData:{value:function(a){var b=void 0===arguments[1]?!0:arguments[1];this._data[a]=b},writable:!0,enumerable:!0,configurable:!0},getData:{value:function(a){return this._data[a]},writable:!0,enumerable:!0,configurable:!0},hasData:{value:function(a){return"undefined"!=typeof this._data[a]},writable:!0,enumerable:!0,configurable:!0},show:{value:function(){this.renderer.draw();var a=this;this.getData("tween")&&TWEEN&&TWEEN.update(),requestAnimationFrame(function(){a.show()})},writable:!0,enumerable:!0,configurable:!0},_attachInteractive:{value:function(){var a=this.renderer,b=new LiThree.Interactive(a);this.interactive=b},writable:!0,enumerable:!0,configurable:!0}}),a}(),f=function(){function a(a){this.canvas=a,this.quaternion=new LiThree.Math.Quaternion,this.matrix=null,this.origin=new LiThree.Math.Vector3,this.speed=1,a.renderer.camera.position.z=-10,this._getMatrix()}return d(a,null,{rotate:{value:function(a,b){a*=this.speed,b*=this.speed;var c=Math.sqrt(a*a+b*b),d=new LiThree.Math.Quaternion(1,0,0,0),e=this.quaternion,f=Math.sin(c*Math.PI)/c;1e-6>c||(d.x=Math.cos(c*Math.PI),d.y=0,d.z=f*a,d.w=-f*b,this.quaternion=new LiThree.Math.Quaternion(1,0,0,0),this.quaternion.multiply(d),this.quaternion.multiply(e),this._getMatrix())},writable:!0,enumerable:!0,configurable:!0},distance:{value:function(a){var b=this.canvas,c=b.renderer.camera;if(a*=this.speed/50,b.getData("tween")){var d=c.position.z+a;new TWEEN.Tween(c.position).to({z:d},200).easing(TWEEN.Easing.Cubic.Out).start()}else c.position.z+=a/2},writable:!0,enumerable:!0,configurable:!0},_getMatrix:{value:function(){return this.matrix=LiThree.Math.Matrix4.fromRotationTranslationScaleOrigin(this.quaternion,this.origin,new LiThree.Math.Vector3(1,1,1),this.origin),this.matrix},writable:!0,enumerable:!0,configurable:!0}}),a}(),g=function(){function a(a){this.canvas=a,this._atoms=[]}return d(a,null,{drawAll:{value:function(){},writable:!0,enumerable:!0,configurable:!0}}),a}(),h="ball-and-stick",i={},j=function(a){function e(a){this.lights=[],b(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,a),i.sphere=a.renderer.createProgrammer(),i.sphere.vertexProgram.clear(),i.sphere.fragmentProgram.clear(),this._orbitShader(i.sphere),i.cylinder=a.renderer.createProgrammer(),i.cylinder.vertexProgram.clear(),i.cylinder.fragmentProgram.clear(),this._orbitShader(i.cylinder),this._programCylinderShader(i.cylinder)}return c(e,a),d(e,null,{drawLight:{value:function(){var a=new LiThree.Light.Point;a.specularColor.rgb(.2,.2,.2),a.position.x=-30,a.position.z=-60,a.position.y=-30,this.lights=[a],a.program(i.sphere.vertexProgram,i.sphere.shaderProgram),a.program(i.cylinder.vertexProgram,i.cylinder.shaderProgram)},writable:!0,enumerable:!0,configurable:!0},drawAtom:{value:function(a,b){var c=this.canvas,d=c.renderer,e=d.world,f=a.position,g=Math.exp(-Math.pow(a.element.atomicRadius-91,2)/500)*a.element.atomicRadius/200,j=LiThree.ObjectFactory.Sphere(g,20,20);j.position.copy(f),j.material.shininess=10,j.material.color.hex=a.element.color,e.add(j),j.shader=i.sphere,d.initShape(j);var k={sphere:j,position:j.position,color:j.material.color,radius:g};a.setData(h,k),c.getData("tween")&&(j.scale.set(0,0,0),new TWEEN.Tween(j.scale).to({x:1,y:1,z:1},500).easing(TWEEN.Easing.Elastic.Out).start()),b&&b(null,a)},writable:!0,enumerable:!0,configurable:!0},removeAtom:{value:function(a){var b=this.canvas,c=b.renderer,d=c.world,e=a.getData(h);e&&d.remove(e.sphere)},writable:!0,enumerable:!0,configurable:!0},drawBond:{value:function(a){var b;if(a.hasData(h))return void(b=a.getData(h));b={cylinders:[]},a.setData(h,b);var c=this.canvas.renderer,d=c.world,e=a.begin,f=a.end,g=e.getData(h),j=f.getData(h);if(g&&j){var k=g.position,l=j.position,m=g.color,n=(j.color,k.distance(l)),o=k.clone().add(l).divide(2),p=l.x-k.x,q=l.y-k.y,r=l.z-k.z,s=.06,t=new LiThree.Math.Quaternion;t.rotateZ(Math.atan2(q,p)),t.rotateY(-Math.asin(r/n));for(var u=(a.order-1)*s,v=0;v<a.order;v++){var w=LiThree.ObjectFactory.Cylinder(n,s,s);w.bond=a,w.material.color=m,w.shader=i.cylinder,b.cylinders.push(w),d.add(w)}for(var x in b.cylinders){var w=b.cylinders[x];w.rotation=t,w.position.copy(o),w.position.y+=x*s*2.1-u}}},writable:!0,enumerable:!0,configurable:!0},removeBond:{value:function(a){var b=this.canvas,c=b.renderer,d=c.world,e=a.getData(h);if(e)for(var f in e.cylinders)d.remove(e.cylinders[f])},writable:!0,enumerable:!0,configurable:!0},_programCylinderShader:{value:function(a){var b=a.fragmentProgram,c=a.vertexProgram;b.clear(),b.code("vec3 effectiveColor = halfColor > 0.5 ? vColor : %c2; gl_FragColor = vec4(%lw + effectiveColor, 1.0);",{c2:b.uniform("vec3",function(a){this.value(a.bond.end.getData(h).color.toArray())}),hc:b.varying("float","halfColor"),lw:"lightWeight"}),c.code("%hc = %vp.x < 0.5 ? 1.0 : 0.0;",{lw:"lightWeight",vp:"vPosition",hc:c.varying("float","halfColor")})},writable:!0,enumerable:!0,configurable:!0},_orbitShader:{value:function(a){var b=(a.fragmentProgram,a.vertexProgram),c=this.canvas.orbitHelper;b.code("mat4 mvMatrix = %vm * %om * %mm;\ngl_Position = %p * mvMatrix  * vec4(%vp, 1.0);",{p:"pMatrix",vm:"vMatrix",mm:"mMatrix",vp:"vPosition",om:b.uniform("mat4",function(){this.value(c.matrix)})}),a.initLighting()},writable:!0,enumerable:!0,configurable:!0},create:{value:function(){this.drawLight(),this.up()},writable:!0,enumerable:!0,configurable:!0},up:{value:function(){var a=renderer.world;for(var b in this.lights)a.add(this.lights[b])},writable:!0,enumerable:!0,configurable:!0},down:{value:function(){var a=renderer.world;for(var b in this.lights)a.remove(this.lights[b])},writable:!0,enumerable:!0,configurable:!0}}),e}(g),k=function(){function a(a){this.canvas=a}return d(a,null,{up:{value:function(){var a=this.canvas.interactive;a.on("drag",this._dragEvent),a.on("click",this._clickEvent),a.on("tap",this._clickEvent),a.on("wheel",this._wheelEvent)},writable:!0,enumerable:!0,configurable:!0},down:{value:function(){var a=this.canvas.interactive;a.off("drag",this._dragEvent),a.off("click",this._clickEvent),a.off("wheel",this._wheelEvent)},writable:!0,enumerable:!0,configurable:!0},create:{value:function(){var a=this.canvas,b=a.renderer.camera,c=a.orbitHelper;this._wheelEvent=function(a){c.distance(a)},this._clickEvent=function(d,e){var f=e(0);f.unproject(c.matrix.clone());var g=new Chem.Atom;g.position=f,g.atomicNumber=6;{var h=LiThree.Math.Ray.fromPoints(b.position,e(0)),i=new LiThree.RayCaster(h);i.intersectTriangle(new LiThree.Math.Vector3(-1,-1,0),new LiThree.Math.Vector3(-1,1,0),new LiThree.Math.Vector3(1,0,0))}a.addAtom(g)},this._dragEvent=function(a,b,c,d){c(.5);0===d.button||2===d.button},this.up()},writable:!0,enumerable:!0,configurable:!0}}),a}(),l=function(){function a(a){this.canvas=a}return d(a,null,{up:{value:function(){var a=this.canvas.interactive;a.on("drag",this._dragEvent),a.on("touchmove",this._dragEvent),a.on("wheel",this._wheelEvent)},writable:!0,enumerable:!0,configurable:!0},down:{value:function(){var a=this.canvas.interactive;a.off("drag",this._dragEvent),a.off("touchmove",this._dragEvent),a.off("wheel",this._wheelEvent)},writable:!0,enumerable:!0,configurable:!0},create:{value:function(){var a=this.canvas,b=a.renderer.camera,c=a.orbitHelper;this._wheelEvent=function(a){c.distance(a)},this._dragEvent=function(c,d,e,f){if(f instanceof TouchEvent||0===f.button){var g=-d.x/400,h=-d.y/400;a.orbitHelper.rotate(g,h)}else 2===f.button&&(f.preventDefault(),b.position.x+=-d.x/100,b.position.y+=d.y/100)},this.up()},writable:!0,enumerable:!0,configurable:!0}}),a}();a.MolCanvas={Canvas:e,Display:{BallAndStick:j},Mode:{Orbit:l,Editor:k}}}(this);
//# sourceMappingURL=molcanvas.min.js.map